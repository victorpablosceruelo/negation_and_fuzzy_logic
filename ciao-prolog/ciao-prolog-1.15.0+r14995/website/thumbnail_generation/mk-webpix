#!/bin/sh

# V 2.02
#
# This script generates webpages from your
# digital photos in the current directory.
# It resizes the big shots to web quality
# and stores the originals in ./orig/
# The script is a quick hack. Dont expect too much... ;-)
#
# USAGE:  mk-webpix [JPGs]
#

#--- allow public web access (!)
cat << .end > .htaccess
    Allow from all
    Satisfy any
.end

#--- get the files
PIX="$*"
if [ "${PIX}__" = "__" ]; then
    PIX=$(echo [a-zA-Z0-9]*.[jJ][pP]*[gG])
    fi

mv -f .autothumb .autothumb.orig

#--- use autothumb to reduce to web quality (Yes, this is slow! ;-)
if [ ! -f .autothumb ]; then
    cat << .end > .autothumb

#
# TMP autothumb config file for resizing and adaption
#
#

#WIDTH=1024
#WIDTH=960
THUMBWIDTH=900
#HEIGHT=768
#HEIGHT=720
THUMBHEIGHT=700

THUMBQUALITY=0.75
KEEP_AR=TRUE
SHADOW=FALSE
SHARPNESS=47
.end
    fi

autothumb $PIX


#--- tidy up
mkdir orig
rm *.html
mv $PIX orig
mmv -m '_*' '#l1'
rm .autothumb

mv .xvpics orig

#--- normal autothumb call to generate the HTML page

mv -f .autothumb.orig .autothumb
autothumb $PIX
