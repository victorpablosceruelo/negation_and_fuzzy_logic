# -*- mode: Makefile; -*-
# Misc. options, depending on the SETTINGS file

# ! Assume that DARWIN >= 8.0.0 (i.e. MAC OS >= 10.4)


ifeq ($(DEBUG_LEVEL),profile)
    DEBUG_FLAGS=-pg -DPROFILE -DDEBUG
    PROFILE_LD_FLAGS=-pg
    OPTIM_LEVEL=debug
    OPTIM_FLAGS=
endif


ifeq ($(OPTIM_LEVEL),optimized)
    OPTIM_FLAGS=-O2 -Wall -fno-strict-aliasing -fomit-frame-pointer $(shell $(SYSDEP_FILES)/gcc_m_or_f_options)
endif


# Threads and locks in DARWIN
ifeq ($(USE_THREADS),yes)
    LD_THREAD_LIB=
    LD_LOCK_LIB=
ifeq ($(USE_POSIX_LOCKS),yes)
    THREAD_FLAG=-D_REENTRANT -DTHREADS
else
    THREAD_FLAG=-D_REENTRANT -DTHREADS
endif
else
    LD_THREAD_LIB=
    THREAD_FLAG=
endif

FOREIGN_FILES_FLAG=-DFOREIGN_FILES

#  Local C compiler
LCC=$(CC)

# C compiler
CC=gcc

# Linker
LD=gcc

# C compiler options for generating shared libraries code
CCSHARED=-fPIC

# Linker options for shared objects
LDSHARED=-flat_namespace -dynamiclib -undefined suppress

# Linker options to combine objects
LDCOMBINE=-r

# Extension of shared libraries
SOSUFFIX=.dylib

LIBS=$(LD_THREAD_LIB) $(LD_LOCK_LIB) $(DEBUG_LIBS)

LINK_FLAGS=$(PROFILE_LD_FLAGS)

ARCHNAME=ppc

# Operating system version
OSNAME=DARWIN

# Memory management primitives
# See engine/configure.c: HAS_MMAP includes USE_OWN_MALLOC
MEM_MNG_FLAG=-DHAS_MMAP -DANONYMOUS_MMAP

# How to install an make directories
MKDIR="mkdir -p"
INSTALL=install

DEFAULTYPE=dyn
