# -*- mode: Makefile; -*-
SHELL=/bin/sh
SYSDEP_FILES:=$(CIAOSRC)/config-sysdep
CIAOARCH:=$(shell $(CIAOSRC)/etc/ciao_get_arch)

# Number of processors: use the real number
PROCESSORS:=$(shell $(SYSDEP_FILES)/available_processors $(CIAOARCH))

ETAGS=etags --ignore-indentation

ARCHOS=$(CIAOARCH)

ifneq ($(DEBUG_LEVEL),nodebug)
    CIAODEBUG=-$(DEBUG_LEVEL)
endif

ifeq ($(AND_PARALLEL_EXECUTION),yes)
    ANDPARALLEL=-DANDPARALLEL
else
ifeq ($(AND_PARALLEL_EXECUTION),visandor)
    ANDPARALLEL=-DANDPARALLEL -DVISANDOR
endif
ifeq ($(AND_PARALLEL_EXECUTION),no)
    ANDPARALLEL=
endif
endif

ifeq ($(PAR_BACK),yes)
    PARBACK=-DPARBACK
endif

ifeq ($(TABLED_EXECUTION),yes)
    TABLING=-DTABLING
endif

# General optimization flags; can be overriden in specific architectures
ifeq ($(CIAODEBUG),-debug)
    OPTIM_LEVEL=normal
ifeq ($(DEBUG_LEVEL),nodebug)
    DEBUG_LEVEL=debug
endif
endif

ifeq ($(OPTIM_LEVEL),optimized)
    OPTIM_FLAGS=-O2
else
ifeq ($(OPTIM_LEVEL),normal)
    OPTIM_FLAGS=
endif
endif

ifeq ($(DEBUG_LEVEL),paranoid-debug)
    DEBUG_FLAGS=-g -Wall -W -Wtraditional -Wshadow -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wcast-align -Wconversion -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -Wnested-externs -Winline -DDEBUG
else
ifeq ($(DEBUG_LEVEL),debug)
    DEBUG_FLAGS=-g -Wall -DDEBUG -DGLOBVARS -DINTERNAL_CALLING
else
ifeq ($(DEBUG_LEVEL),nodebug)
    DEBUG_FLAGS=
else
ifeq ($(DEBUG_LEVEL),profile)
    DEBUG_FLAGS=-DDEBUG -DPROFILE
#    DEBUG_FLAGS= -DPROFILE
else
ifeq ($(DEBUG_LEVEL),profile-debug)
    DEBUG_FLAGS=-g -Wall -DDEBUG -DGLOBVARS -DINTERNAL_CALLING -DPROFILE
endif
endif
endif
endif
endif

#INSTALLIBARCHDIR=$(INSTALLIBDIR)/$(CIAOARCH)$(CIAODEBUG)

CFLAGS= $(OPTIM_FLAGS) $(DEBUG_FLAGS) $(THREAD_FLAG)			\
$(FOREIGN_FILES_FLAG) $(ANDPARALLEL) $(VISANDOR) $(PARBACK) $(TABLING)		\
-D$(OSNAME) -D$(ARCHNAME) $(ARCHFLAGS) $(MEM_MNG_FLAG) $(EXTRA_CFLAGS)

LDFLAGS= $(LINK_FLAGS) $(EXTRA_LDFLAGS)

-include SETTINGS_GSL
