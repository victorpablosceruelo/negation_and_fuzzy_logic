"
SELECT rel1.ID , rel1.QUANTITY+
(SELECT MAX(rel4.ID)
FROM PRODUCT rel4
WHERE rel4.QUANTITY = 2 AND rel4.NAME = 'b'
)
FROM PRODUCT rel1
WHERE rel1.NAME = 'a' AND NOT EXISTS
(SELECT *
FROM PRODUCT rel2
WHERE rel2.ID = 2 AND rel2.QUANTITY = 3 AND rel2.NAME = 'b'
) AND rel1.ID+2 > 
(SELECT AVG(rel3.QUANTITY)
FROM PRODUCT rel3
WHERE rel3.NAME = 'a'
)

UNION

SELECT rel5.ID , rel5.QUANTITY+
(SELECT MAX(rel8.ID)
FROM PRODUCT rel8
WHERE rel8.QUANTITY = 2 AND rel8.NAME = 'b'
)
FROM PRODUCT rel5
WHERE rel5.NAME = 'b' AND NOT EXISTS
(SELECT *
FROM PRODUCT rel6
WHERE rel6.ID = 2 AND rel6.QUANTITY = 3 AND rel6.NAME = 'b'
) AND rel5.ID+2 > 
(SELECT AVG(rel7.QUANTITY)
FROM PRODUCT rel7
WHERE rel7.NAME = 'a'
)
;

".
