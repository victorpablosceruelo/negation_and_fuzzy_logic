<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-15">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 1.0.1  (Linux)">
	<META NAME="AUTHOR" CONTENT="Oleg Kalnichevski, Jeff Dever">
	<STYLE>
	<!--
		@page { size: 21.59cm 27.94cm; margin-left: 3.18cm; margin-right: 3.18cm; margin-top: 2.54cm; margin-bottom: 2.54cm }
		P { margin-bottom: 0.21cm }
		H1 { margin-bottom: 0.21cm }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
		H1.cjk { font-size: 16pt }
		H1.ctl { font-size: 16pt }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US">
<H1 CLASS="western">Jakarta Commons HttpClient: Test WebApp How-To</H1>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Rationale</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">Complex software development efforts
with many developers collaborating on the same code base require a
means of ensuring that changes introduced in one module do not
produce a rippling effect on other modules by breaking some
dependencies or assumptions. One of the widely employed approaches to
achieve such goal calls for simultaneous development of software
units and corresponding test cases. The latter can be executed
against the former in order to ensure that the software units comply
with their contract or programming interface. Such suite of test
cases helps developers ensure formal validity and integrity of the
their software artifact while it evolves through multiple development
cycles.</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">JUnit, a popular open-source unit
testing framework, has been employed in the HttpClient project.
Please refer to the JUnit web site for more detailed information</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm"><A HREF="http://www.junit.org/index.htm">http://www.junit.org/index.htm</A></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Different
types of unit tests in the HttpClient project</FONT></FONT></P>
<UL>
	<LI><P>Test cases that have no external dependencies in order to
	execute;</P>
	<LI><P>Test cases that require access to external public resources
	(usually high profile web sites);</P>
	<LI><P>Test cases that must be run against a local web application
	that implements test specific functions and produces specific HTTP
	responses. These tests are the most critical component of the entire
	test suite as they allow for testing of most arcane aspects of the
	HTTP protocol that are not easily reproducible with external
	resources. 
	</P>
</UL>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">It is absolutely crucial that patches
are tested for compliance with the entire test  suite in order to be
considered for acceptance into the main CVS trunk</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">The purpose of this document is to help
potential HttpClient contributors compile and deploy the test web
application (later referred as Test WebApp)</P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Test
WebApp external dependencies</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">In order to successfully compile the
Test WebApp we need satisfy the following external dependencies 
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0cm">Apache Jakarta Tomcat servlet
	engine version 4.0.3 or higher</P>
	<P STYLE="margin-bottom: 0cm"><A HREF="http://jakarta.apache.org/tomcat/index.html">http://jakarta.apache.org/tomcat/index.html</A></P>
	<P STYLE="margin-bottom: 0cm">Technically any Servlet 2.3 and JSP
	1.2 compliant servlet engine should do. However, the Test WebApp has
	been mostly used with Tomcat servlet engine.</P>
	<LI><P STYLE="margin-bottom: 0cm">Apache Jakarta Ant build tool
	version 1.5.1 or higher</P>
	<P STYLE="margin-bottom: 0cm"><A HREF="http://jakarta.apache.org/ant/index.html">http://jakarta.apache.org/ant/index.html</A>
		</P>
	<LI><P STYLE="margin-bottom: 0cm">JUnit unit testing framework
	version 3.7 or higher</P>
	<P STYLE="margin-bottom: 0cm"><A HREF="http://www.junit.org/index.htm">http://www.junit.org/index.htm</A></P>
	<LI><P STYLE="margin-bottom: 0cm">Java<FONT SIZE=1><SUP>TM</SUP></FONT>
	Secure Socket Extension (JSSE) version 1.0.3 or higher</P>
	<P STYLE="margin-bottom: 0cm"><A HREF="http://www.junit.org/index.htm">http://java.sun.com/products/jsse/</A></P>
	<P STYLE="margin-bottom: 0cm"></P>
</UL>
<P STYLE="margin-bottom: 0cm">This document assumes basic familiarity
with these technologies. If you need more detailed information about
any of them, please refer to the links provided above. 
</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">If you need assistance in deploying the
Tomcat servlet engine please refer to the following document</P>
<P STYLE="margin-bottom: 0cm"><A HREF="http://jakarta.apache.org/tomcat/tomcat-4.0-doc/RUNNING.txt">http://jakarta.apache.org/tomcat/tomcat-4.0-doc/RUNNING.txt</A></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Development
environment</FONT></FONT></P>
<UL>
	<LI><P>JDK: 1.2.2 or higher</P>
	<LI><P>OS: Unix or Unix like</P>
</UL>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Specify
Test WebApp build properties</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">Update references in the file
build.properties to refer to correct locations on your local system.
The  build.properties is located in the root directory of the
HttpClient source tree</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm">Most importantly the location of the
following packages must be specified: <B>junit.jar, servlet.jar</B></P>
<P STYLE="margin-bottom: 0cm"><B>For example, you can copy the
build.properties.sample to your home directory as build.properties
and modify the following lines to match your system configuration:</B></P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P STYLE="margin-bottom: 0cm"><B>servlet.jar=/usr/local/jakarta-tomcat/common/lib/servlet.jar</B></P>
<P STYLE="margin-bottom: 0cm"><B>junit.jar=/usr/local/junit/junit.jar</B></P>
<P><BR><BR>
</P>
<P>The explicit specification of the following JSSE packages are
optional if you are using Sun JDK 1.4.0 or higher or IBM JDK 1.3.0 or
higher with security options:  <B>jsse.jar, jnet.jar, jcert.jar,
jce.jar</B></P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Build
Test WebApp</FONT></FONT></P>
<P STYLE="margin-bottom: 0cm">Change your current directory to the
root directory of the HttpClient source tree</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P>Execute</P>
<P><FONT FACE="Lucida Console">&lt;/opt/ant&gt;/bin/ant
test-webapp-war</FONT></P>
<P>Where</P>
<P>&lt;/opt/ant&gt; is the root directory of the Ant build tool</P>
<P><BR><BR>
</P>
<P STYLE="margin-bottom: 0cm">If all external dependencies have been
correctly specified the execution of the Ant task should result in
creation of the Java web archive at the following location:</P>
<P STYLE="margin-bottom: 0cm"><BR>
</P>
<P><FONT FACE="Lucida Console">./target/httpclienttest.war</FONT></P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Deploy
Test WebApp</FONT></FONT></P>
<P>Stop Tomcat</P>
<P><FONT FACE="Lucida Console">./bin/shutdown.sh</FONT></P>
<P>Make sure you have write permissions for the following location 
</P>
<P><FONT FACE="Lucida Console">&lt;/var/tomcat/&gt;webapps or
/usr/local/jakarta-tomcat/webapps</FONT></P>
<P><FONT FACE="Arial, sans-serif">Where</FONT></P>
<P><FONT FACE="Arial, sans-serif">&lt;/var/tomcat/&gt; is the base
directory of the Tomcat service (CATALINA_BASE) </FONT>
</P>
<P><FONT FACE="Arial, sans-serif">Drop the resultant WAR file into
the &lt;/var/tomcat/&gt;webapps directory</FONT></P>
<P><FONT FACE="Arial, sans-serif">Restart Tomcat</FONT></P>
<P><FONT FACE="Lucida Console">./bin/startup.sh</FONT></P>
<P><FONT FACE="Arial, sans-serif">Tomcat will check for new web
archives in its base directory and automatically deploy them.</FONT></P>
<P><FONT FACE="Arial, sans-serif">Point your browser to the following
URL: <A HREF="http://127.0.0.1:8080/httpclienttest/headers">http://127.0.0.1:8080/httpclienttest/headers</A></FONT></P>
<P><FONT FACE="Arial, sans-serif">If the Test WebApp has been
properly deployed and is ready for use you should see similar
response in your browser</FONT></P>
<P><BR><BR>
</P>
<P><FONT FACE="Lucida Console"><FONT SIZE=1 STYLE="font-size: 8pt">This
is a response to an HTTP GET request.</FONT></FONT></P>
<P><FONT FACE="Lucida Console"><FONT SIZE=1 STYLE="font-size: 8pt">Request
Headers:</FONT></FONT></P>
<P><FONT FACE="Lucida Console"><FONT SIZE=1 STYLE="font-size: 8pt">name=&quot;host&quot;;value=&quot;127.0.0.1:8080&quot;<BR>name=&quot;user-agent&quot;;value=&quot;Mozilla/5.0
(X11; U; Linux i686; en-US; rv:1.3a) Gecko/20021207
Phoenix/0.5&quot;<BR>name=&quot;accept&quot;;value=&quot;text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,video/x-mng,image/png,image/jpeg,image/gif;q=0.2,*/*;q=0.1&quot;<BR>name=&quot;accept-language&quot;;value=&quot;en-us,en;q=0.5&quot;<BR>name=&quot;accept-encoding&quot;;value=&quot;gzip,deflate,compress;q=0.9&quot;<BR>name=&quot;accept-charset&quot;;value=&quot;ISO-8859-1,utf-8;q=0.7,*;q=0.7&quot;<BR>name=&quot;keep-alive&quot;;value=&quot;300&quot;<BR>name=&quot;connection&quot;;value=&quot;keep-alive&quot;</FONT></FONT></P>
<P STYLE="margin-top: 0.42cm; page-break-after: avoid"><FONT FACE="Arial, sans-serif"><FONT SIZE=4>Run
test cases</FONT></FONT></P>
<P>In case you run a non-default installation of the Tomcat servlet
engine you may need to update the following properties in the
build.properties file</P>
<P><BR><BR>
</P>
<P><A HREF="httpclient.test.localHost">httpclient.test.localHost</A>:	the
host name for the &quot;local&quot; webserver (default: 127.0.0.1)</P>
<P><A HREF="http://httpclient.test.localPort/">httpclient.test.localPort</A>:	the
port for the &quot;local&quot; webserver (default: 8080)</P>
<P><A HREF="httpclient.test.webappContext">httpclient.test.webappContext</A>:	the
context to which the test webapp is deployed (default:
httpclienttest)</P>
<P><BR><BR>
</P>
<P>Execute</P>
<P><FONT FACE="Lucida Console">&lt;/opt/ant&gt;/bin/ant test-local</FONT></P>
<P>Where</P>
<P>&lt;/opt/ant&gt; is the root directory of the Ant build tool</P>
<P>You should receive BUILD SUCCESSFUL message if all test cases
succeeded</P>
<P><BR><BR>
</P>
<P>In case of test failures you will see similar output</P>
<pre>
  [java] ..............
  [java] Time: 18,067
  [java] There was 1 failure:
  [java] 1)
testConnTimeout(org.apache.commons.httpclient.TestHttpConnection)junit.framework.AssertionFailedError:
Should have timed out
  [java] 	at org.apache.commons.httpclient.TestHttpConnection.testConnTimeout(TestHttpConnection.java:114)
  [java] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  [java] 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
  [java] 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)

  [java] FAILURES!!!
  [java] Tests run: 260,  Failures: 1,  Errors: 0
</pre>
<BR>

<P>Disregard WARN messages. The test cases run through valid and invalid cases and as such 
warnings are part of the HttpClient test sequence.</P>

</BODY>
</HTML>
